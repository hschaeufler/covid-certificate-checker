import {ElectronicHealthCertificateChecker} from "../src";

describe("A Covid-Certificate-Checker-Testsuite", function () {


    it("delivers valid HeatlhCertificate", function () {
        const testCertificate = "HC1:6BF+70790T9WJWG.FKY*4GO0.O1CV2 O5 N2FBBRW1*70HS8WY04AC*WIFN0AHCD8KD97TK0F90KECTHGWJC0FDC:5AIA%G7X+AQB9746HS80:54IBQF60R6$A80X6S1BTYACG6M+9XG8KIAWNA91AY%67092L4WJCT3EHS8XJC +DXJCCWENF6OF63W5NW6WF6%JC QE/IAYJC5LEW34U3ET7DXC9 QE-ED8%E.JCBECB1A-:8$96646AL60A60S6Q$D.UDRYA 96NF6L/5QW6307KQEPD09WEQDD+Q6TW6FA7C466KCN9E%961A6DL6FA7D46JPCT3E5JDLA7$Q6E464W5TG6..DX%DZJC6/DTZ9 QE5$CB$DA/D JC1/D3Z8WED1ECW.CCWE.Y92OAGY8MY9L+9MPCG/D5 C5IA5N9$PC5$CUZCY$5Y$527BHB6*L8ARHDJL.Q7*2T7:SCNFZN70H6*AS6+T$D9UCAD97R8NIBO+/RJVE$9PAGPTBIZEP MO-Q0:R13IURRQ5MV93M9V3X2U:NDZSF";
        const jsonCertificateClaim = "{\"iss\":\"DE\",\"iat\":1643356073,\"exp\":1622316073,\"hcert\":{\"v\":[{\"ci\":\"URN:UVCI:01DE/IZ12345A/5CWLU12RNOB9RXSEOP6FG8#W\",\"co\":\"DE\",\"dn\":1,\"dt\":\"2021-05-29\",\"is\":\"Robert Koch-Institut\",\"ma\":\"ORG-100031184\",\"mp\":\"EU/1/20/1507\",\"sd\":2,\"tg\":\"840539006\",\"vp\":\"1119349007\"}],\"dob\":\"1964-08-12\",\"nam\":{\"fn\":\"Mustermann\",\"gn\":\"Erika\",\"fnt\":\"MUSTERMANN\",\"gnt\":\"ERIKA\"},\"ver\":\"1.0.0\"}}";

        const healthCertificateClaim = ElectronicHealthCertificateChecker.decodeCertificate(testCertificate)
        expect(JSON.stringify(healthCertificateClaim)).toEqual(jsonCertificateClaim);
    });

    it("Verifys a certificate", async function () {
        const testCertificate = "HC1:6BF+70790T9WJWG.FKY*4GO0.O1CV2 O5 N2FBBRW1*70HS8WY04AC*WIFN0AHCD8KD97TK0F90KECTHGWJC0FDC:5AIA%G7X+AQB9746HS80:54IBQF60R6$A80X6S1BTYACG6M+9XG8KIAWNA91AY%67092L4WJCT3EHS8XJC +DXJCCWENF6OF63W5NW6WF6%JC QE/IAYJC5LEW34U3ET7DXC9 QE-ED8%E.JCBECB1A-:8$96646AL60A60S6Q$D.UDRYA 96NF6L/5QW6307KQEPD09WEQDD+Q6TW6FA7C466KCN9E%961A6DL6FA7D46JPCT3E5JDLA7$Q6E464W5TG6..DX%DZJC6/DTZ9 QE5$CB$DA/D JC1/D3Z8WED1ECW.CCWE.Y92OAGY8MY9L+9MPCG/D5 C5IA5N9$PC5$CUZCY$5Y$527BHB6*L8ARHDJL.Q7*2T7:SCNFZN70H6*AS6+T$D9UCAD97R8NIBO+/RJVE$9PAGPTBIZEP MO-Q0:R13IURRQ5MV93M9V3X2U:NDZSF";
        //raw-Key is from: https://de.test.dscg.ubirch.com/trustList/DSC/
        const rawKey = "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";
        const jsonCertificateClaim = "{\"iss\":\"DE\",\"iat\":1643356073,\"exp\":1622316073,\"hcert\":{\"v\":[{\"ci\":\"URN:UVCI:01DE/IZ12345A/5CWLU12RNOB9RXSEOP6FG8#W\",\"co\":\"DE\",\"dn\":1,\"dt\":\"2021-05-29\",\"is\":\"Robert Koch-Institut\",\"ma\":\"ORG-100031184\",\"mp\":\"EU/1/20/1507\",\"sd\":2,\"tg\":\"840539006\",\"vp\":\"1119349007\"}],\"dob\":\"1964-08-12\",\"nam\":{\"fn\":\"Mustermann\",\"gn\":\"Erika\",\"fnt\":\"MUSTERMANN\",\"gnt\":\"ERIKA\"},\"ver\":\"1.0.0\"}}";

        const {
            healthCertificateClaim,
            isVerified
        } = await ElectronicHealthCertificateChecker.verifyCertificate(testCertificate, rawKey);

        expect(JSON.stringify(healthCertificateClaim)).toEqual(jsonCertificateClaim);
        expect(isVerified).toEqual(true);
    });


    it("Verifys a certificate with TrustList", async function () {
        const testCertificate = "HC1:6BF+70790T9WJWG.FKY*4GO0.O1CV2 O5 N2FBBRW1*70HS8WY04AC*WIFN0AHCD8KD97TK0F90KECTHGWJC0FDC:5AIA%G7X+AQB9746HS80:54IBQF60R6$A80X6S1BTYACG6M+9XG8KIAWNA91AY%67092L4WJCT3EHS8XJC +DXJCCWENF6OF63W5NW6WF6%JC QE/IAYJC5LEW34U3ET7DXC9 QE-ED8%E.JCBECB1A-:8$96646AL60A60S6Q$D.UDRYA 96NF6L/5QW6307KQEPD09WEQDD+Q6TW6FA7C466KCN9E%961A6DL6FA7D46JPCT3E5JDLA7$Q6E464W5TG6..DX%DZJC6/DTZ9 QE5$CB$DA/D JC1/D3Z8WED1ECW.CCWE.Y92OAGY8MY9L+9MPCG/D5 C5IA5N9$PC5$CUZCY$5Y$527BHB6*L8ARHDJL.Q7*2T7:SCNFZN70H6*AS6+T$D9UCAD97R8NIBO+/RJVE$9PAGPTBIZEP MO-Q0:R13IURRQ5MV93M9V3X2U:NDZSF";
        //TrustList-Extract is from: https://de.test.dscg.ubirch.com/trustList/DSC/
        const trustList = {
            "certificates": [{
                "certificateType": "DSC",
                "country": "DE",
                "kid": "DEsVUSvpFAE=",
                "rawData": "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",
                "signature": "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",
                "thumbprint": "0c4b15512be914016eea23da5eae865c63bbb9046dd4af409e230202c6a57477",
                "timestamp": "2021-06-05T11:43:55+02:00"
            }, {
                "certificateType": "DSC",
                "country": "DE",
                "kid": "DJANd2eecu8=",
                "rawData": "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",
                "signature": "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",
                "thumbprint": "0c900d77679e72ef4bb7d36aeda9552ab8d13a5992f40c634aa83aef486435ba",
                "timestamp": "2021-11-30T17:50:48+01:00"
            }]
        };
        const jsonCertificateClaim = "{\"iss\":\"DE\",\"iat\":1643356073,\"exp\":1622316073,\"hcert\":{\"v\":[{\"ci\":\"URN:UVCI:01DE/IZ12345A/5CWLU12RNOB9RXSEOP6FG8#W\",\"co\":\"DE\",\"dn\":1,\"dt\":\"2021-05-29\",\"is\":\"Robert Koch-Institut\",\"ma\":\"ORG-100031184\",\"mp\":\"EU/1/20/1507\",\"sd\":2,\"tg\":\"840539006\",\"vp\":\"1119349007\"}],\"dob\":\"1964-08-12\",\"nam\":{\"fn\":\"Mustermann\",\"gn\":\"Erika\",\"fnt\":\"MUSTERMANN\",\"gnt\":\"ERIKA\"},\"ver\":\"1.0.0\"}}";

        const {
            healthCertificateClaim,
            isVerified
        } = await ElectronicHealthCertificateChecker.verifyCertificate(testCertificate, undefined, trustList);

        expect(JSON.stringify(healthCertificateClaim)).toEqual(jsonCertificateClaim);
        expect(isVerified).toEqual(true);
    });

});